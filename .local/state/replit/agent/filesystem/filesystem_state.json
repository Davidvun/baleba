{"file_contents":{"replit.md":{"content":"# E-Learning Platform\n\n## Overview\nA comprehensive e-learning platform built with Django backend and HTML + Tailwind CSS frontend. The platform supports three user roles: Admin, Tutor, and Student, with complete course management, video streaming, quizzes, attendance tracking, and payment integration.\n\n## Tech Stack\n- **Backend**: Django 5.2.7, PostgreSQL\n- **Frontend**: HTML, Tailwind CSS, Vanilla JavaScript\n- **Payment**: Stripe (configured but not yet implemented)\n- **Authentication**: Django built-in with custom User model\n\n## Project Structure\n```\nelearning/\nâ”œâ”€â”€ accounts/          # User authentication and management\nâ”œâ”€â”€ courses/           # Course, Unit, Video, Material models\nâ”œâ”€â”€ quizzes/           # Quiz system with questions and leaderboard\nâ”œâ”€â”€ payments/          # Stripe payment integration\nâ”œâ”€â”€ settings.py        # Django settings\nâ””â”€â”€ urls.py           # URL routing\n\ntemplates/            # HTML templates with Tailwind CSS\nâ”œâ”€â”€ base.html         # Base template\nâ”œâ”€â”€ home.html         # Landing page\nâ”œâ”€â”€ accounts/         # Login, Register templates\nâ””â”€â”€ dashboards/       # Role-specific dashboards\n\nstatic/               # Static files (CSS, JS)\nmedia/                # User uploaded files\n```\n\n## User Roles\n\n### Admin\n- Full platform management\n- User management (create, edit, suspend)\n- Content moderation and approval\n- Analytics and reporting\n- Payment transaction monitoring\n\n### Tutor\n- Create and manage courses\n- Upload videos and materials\n- Create quizzes for videos\n- View student performance\n- Track engagement metrics\n\n### Student\n- Browse and purchase courses\n- Watch videos with attendance tracking\n- Take quizzes with instant grading\n- Track progress and achievements\n- View leaderboards\n\n## Database Models\n\n### Accounts App\n- **User**: Custom user with roles (admin, tutor, student)\n- **UserSession**: Single device login enforcement\n- **ActivityLog**: User activity tracking\n\n### Courses App\n- **Category**: Course categories\n- **Course**: Main course model with pricing\n- **Unit**: Course units/modules\n- **Video**: Video content with streaming\n- **Material**: PDF, documents, slides\n- **VideoWatch**: Watch tracking and progress\n- **Attendance**: Active viewing detection\n- **CourseEnrollment**: Student course enrollment\n\n### Quizzes App\n- **Question**: Quiz questions per video\n- **Answer**: Multiple choice answers\n- **Quiz**: Quiz configuration per video\n- **QuizAttempt**: Student quiz attempts\n- **StudentAnswer**: Individual answers\n- **Leaderboard**: Unit-wise rankings\n\n### Payments App\n- **Purchase**: Course purchases\n- **Transaction**: Payment transactions\n- **PaymentMethod**: Saved payment methods\n\n## Key Features Implemented\n\nâœ… **Authentication System**\n- Role-based login (Admin, Tutor, Student)\n- 3-month session duration (90 days)\n- Secure registration (students and tutors only, no admin self-registration)\n- Role-based access control with decorators\n- Single device login enforcement via middleware\n- UserSession tracking for security\n\nâœ… **Database Structure**\n- Complete models for all features\n- PostgreSQL database configured\n- Migrations applied successfully\n\nâœ… **Admin Interface**\n- Django admin configured for all models\n- Custom admin panels with filters and search\n\nâœ… **Basic Templates**\n- Responsive design with Tailwind CSS\n- Role-based navigation\n- Login/Register forms\n- Dashboard placeholders\n\n## Features In Progress\n\nðŸ”„ **Course Management**\n- Course creation and editing\n- Unit and video management\n- Material upload and access control\n\nðŸ”„ **Video Streaming**\n- Active viewing detection\n- Attendance tracking\n- Progress monitoring\n\nðŸ”„ **Quiz System**\n- Auto-generated quizzes after videos\n- Instant grading and feedback\n- Leaderboard calculations\n\nðŸ”„ **Payment Integration**\n- Stripe checkout\n- Purchase tracking\n- Transaction management\n\n## Default Admin Credentials\n- **Username**: admin\n- **Password**: admin123\n- **Role**: Admin\n\n## Session Configuration\n- Session expires after 90 days (3 months)\n- Auto-save on every request\n- Login required for protected routes\n\n## Environment Variables\n- `DATABASE_URL`: PostgreSQL connection\n- `STRIPE_PUBLIC_KEY`: Stripe public key (to be set)\n- `STRIPE_SECRET_KEY`: Stripe secret key (to be set)\n- `STRIPE_WEBHOOK_SECRET`: Stripe webhook secret (to be set)\n\n## Next Steps\n1. Implement course browsing and filtering for students\n2. Build tutor course creation interface\n3. Add video upload and streaming functionality\n4. Implement quiz creation and taking system\n5. Integrate Stripe payment processing\n6. Add attendance tracking JavaScript\n7. Build leaderboard display\n8. Implement email notifications\n\n## Recent Changes (October 14, 2025)\n- âœ… Set up Django project with PostgreSQL\n- âœ… Created custom User model with role system\n- âœ… Configured all database models\n- âœ… Set up Django admin for all apps\n- âœ… Created authentication views and templates\n- âœ… Configured workflow for Django server\n- âœ… Added Tailwind CSS for styling\n- âœ… Implemented role-based access control decorators\n- âœ… Added single device login middleware\n- âœ… Fixed security: prevented admin self-registration\n- âœ… Protected dashboard routes with role verification\n\n## Development Server\nThe Django development server runs on port 5000.\nAccess the application at the provided Replit URL.\n","size_bytes":5375},"elearning/payments/views.py":{"content":"from django.shortcuts import render\n\n# Create your views here.\n","size_bytes":63},"elearning/accounts/models.py":{"content":"from django.db import models\nfrom django.contrib.auth.models import AbstractUser\nfrom django.utils import timezone\n\nclass User(AbstractUser):\n    ROLE_CHOICES = [\n        ('admin', 'Admin'),\n        ('tutor', 'Tutor'),\n        ('student', 'Student'),\n    ]\n    \n    role = models.CharField(max_length=10, choices=ROLE_CHOICES, default='student')\n    phone = models.CharField(max_length=20, blank=True, null=True)\n    email_verified = models.BooleanField(default=False)\n    phone_verified = models.BooleanField(default=False)\n    is_suspended = models.BooleanField(default=False)\n    profile_picture = models.ImageField(upload_to='profiles/', blank=True, null=True)\n    bio = models.TextField(blank=True, null=True)\n    \n    def __str__(self):\n        return f\"{self.username} ({self.get_role_display()})\"\n    \n    def is_admin(self):\n        return self.role == 'admin'\n    \n    def is_tutor(self):\n        return self.role == 'tutor'\n    \n    def is_student(self):\n        return self.role == 'student'\n\n\nclass UserSession(models.Model):\n    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='user_sessions')\n    session_key = models.CharField(max_length=40, unique=True)\n    device_info = models.CharField(max_length=255, blank=True)\n    ip_address = models.GenericIPAddressField(blank=True, null=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    last_activity = models.DateTimeField(auto_now=True)\n    is_active = models.BooleanField(default=True)\n    \n    def __str__(self):\n        return f\"{self.user.username} - {self.device_info}\"\n    \n    class Meta:\n        ordering = ['-last_activity']\n\n\nclass ActivityLog(models.Model):\n    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='activity_logs')\n    action = models.CharField(max_length=255)\n    description = models.TextField(blank=True)\n    ip_address = models.GenericIPAddressField(blank=True, null=True)\n    timestamp = models.DateTimeField(auto_now_add=True)\n    \n    def __str__(self):\n        return f\"{self.user.username} - {self.action}\"\n    \n    class Meta:\n        ordering = ['-timestamp']\n","size_bytes":2117},"elearning/accounts/admin.py":{"content":"from django.contrib import admin\nfrom django.contrib.auth.admin import UserAdmin\nfrom .models import User, UserSession, ActivityLog\n\n@admin.register(User)\nclass CustomUserAdmin(UserAdmin):\n    list_display = ['username', 'email', 'role', 'is_active', 'is_suspended']\n    list_filter = ['role', 'is_active', 'is_suspended']\n    fieldsets = UserAdmin.fieldsets + (\n        ('Role & Status', {'fields': ('role', 'is_suspended', 'phone', 'email_verified', 'phone_verified')}),\n        ('Profile', {'fields': ('profile_picture', 'bio')}),\n    )\n\n@admin.register(UserSession)\nclass UserSessionAdmin(admin.ModelAdmin):\n    list_display = ['user', 'device_info', 'ip_address', 'is_active', 'last_activity']\n    list_filter = ['is_active', 'created_at']\n    search_fields = ['user__username', 'device_info', 'ip_address']\n\n@admin.register(ActivityLog)\nclass ActivityLogAdmin(admin.ModelAdmin):\n    list_display = ['user', 'action', 'ip_address', 'timestamp']\n    list_filter = ['timestamp']\n    search_fields = ['user__username', 'action', 'description']\n","size_bytes":1046},"elearning/courses/admin.py":{"content":"from django.contrib import admin\nfrom .models import Category, Course, Unit, Video, Material, VideoWatch, Attendance, CourseEnrollment\n\n@admin.register(Category)\nclass CategoryAdmin(admin.ModelAdmin):\n    list_display = ['name', 'created_at']\n    search_fields = ['name']\n\n@admin.register(Course)\nclass CourseAdmin(admin.ModelAdmin):\n    list_display = ['title', 'tutor', 'category', 'price', 'is_free', 'is_approved', 'created_at']\n    list_filter = ['is_free', 'is_approved', 'category']\n    search_fields = ['title', 'tutor__username']\n    prepopulated_fields = {'slug': ('title',)}\n\n@admin.register(Unit)\nclass UnitAdmin(admin.ModelAdmin):\n    list_display = ['title', 'course', 'order', 'created_at']\n    list_filter = ['course']\n    search_fields = ['title', 'course__title']\n\n@admin.register(Video)\nclass VideoAdmin(admin.ModelAdmin):\n    list_display = ['title', 'unit', 'duration', 'is_free', 'order']\n    list_filter = ['is_free', 'unit__course']\n    search_fields = ['title', 'unit__title']\n\n@admin.register(Material)\nclass MaterialAdmin(admin.ModelAdmin):\n    list_display = ['title', 'unit', 'material_type', 'is_free', 'is_downloadable']\n    list_filter = ['material_type', 'is_free']\n    search_fields = ['title', 'unit__title']\n\n@admin.register(VideoWatch)\nclass VideoWatchAdmin(admin.ModelAdmin):\n    list_display = ['student', 'video', 'progress', 'is_completed', 'updated_at']\n    list_filter = ['is_completed', 'is_active']\n    search_fields = ['student__username', 'video__title']\n\n@admin.register(Attendance)\nclass AttendanceAdmin(admin.ModelAdmin):\n    list_display = ['student', 'video', 'date', 'active_watch_time', 'is_present']\n    list_filter = ['is_present', 'date']\n    search_fields = ['student__username', 'video__title']\n\n@admin.register(CourseEnrollment)\nclass CourseEnrollmentAdmin(admin.ModelAdmin):\n    list_display = ['student', 'course', 'enrolled_at', 'is_active', 'progress']\n    list_filter = ['is_active', 'enrolled_at']\n    search_fields = ['student__username', 'course__title']\n","size_bytes":2023},"elearning/quizzes/migrations/__init__.py":{"content":"","size_bytes":0},"elearning/accounts/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass AccountsConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'elearning.accounts'\n","size_bytes":158},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"crispy-tailwind>=1.0.3\",\n    \"django>=5.2.7\",\n    \"django-crispy-forms>=2.4\",\n    \"pillow>=11.3.0\",\n    \"psycopg2-binary>=2.9.11\",\n    \"python-dotenv>=1.1.1\",\n    \"stripe>=13.0.1\",\n]\n","size_bytes":330},"elearning/payments/__init__.py":{"content":"","size_bytes":0},"elearning/quizzes/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.7 on 2025-10-14 08:37\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        ('courses', '0001_initial'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Question',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('question_text', models.TextField()),\n                ('question_type', models.CharField(choices=[('mcq', 'Multiple Choice'), ('true_false', 'True/False')], default='mcq', max_length=20)),\n                ('points', models.PositiveIntegerField(default=1)),\n                ('order', models.PositiveIntegerField(default=0)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('video', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='questions', to='courses.video')),\n            ],\n            options={\n                'ordering': ['order'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Answer',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('answer_text', models.CharField(max_length=500)),\n                ('is_correct', models.BooleanField(default=False)),\n                ('order', models.PositiveIntegerField(default=0)),\n                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='answers', to='quizzes.question')),\n            ],\n            options={\n                'ordering': ['order'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Quiz',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('pass_percentage', models.PositiveIntegerField(default=70)),\n                ('time_limit', models.PositiveIntegerField(default=30, help_text='Time limit in minutes')),\n                ('is_active', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('video', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='quiz', to='courses.video')),\n            ],\n            options={\n                'verbose_name_plural': 'Quizzes',\n            },\n        ),\n        migrations.CreateModel(\n            name='QuizAttempt',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('score', models.FloatField(default=0.0)),\n                ('total_points', models.PositiveIntegerField(default=0)),\n                ('percentage', models.FloatField(default=0.0)),\n                ('is_passed', models.BooleanField(default=False)),\n                ('time_taken', models.PositiveIntegerField(default=0, help_text='Time taken in seconds')),\n                ('started_at', models.DateTimeField(auto_now_add=True)),\n                ('completed_at', models.DateTimeField(blank=True, null=True)),\n                ('quiz', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attempts', to='quizzes.quiz')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quiz_attempts', to=settings.AUTH_USER_MODEL)),\n                ('video', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quiz_attempts', to='courses.video')),\n            ],\n            options={\n                'ordering': ['-started_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Leaderboard',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('total_score', models.FloatField(default=0.0)),\n                ('total_quizzes', models.PositiveIntegerField(default=0)),\n                ('average_score', models.FloatField(default=0.0)),\n                ('rank', models.PositiveIntegerField(default=0)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='leaderboard_entries', to=settings.AUTH_USER_MODEL)),\n                ('unit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='leaderboards', to='courses.unit')),\n            ],\n            options={\n                'ordering': ['rank'],\n                'unique_together': {('unit', 'student')},\n            },\n        ),\n        migrations.CreateModel(\n            name='StudentAnswer',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('is_correct', models.BooleanField(default=False)),\n                ('points_earned', models.FloatField(default=0.0)),\n                ('attempt', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='student_answers', to='quizzes.quizattempt')),\n                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='quizzes.question')),\n                ('selected_answer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='quizzes.answer')),\n            ],\n            options={\n                'unique_together': {('attempt', 'question')},\n            },\n        ),\n    ]\n","size_bytes":5972},"elearning/payments/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.7 on 2025-10-14 08:37\n\nimport django.db.models.deletion\nimport uuid\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        ('courses', '0001_initial'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='PaymentMethod',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('stripe_payment_method_id', models.CharField(max_length=255)),\n                ('card_last4', models.CharField(blank=True, max_length=4)),\n                ('card_brand', models.CharField(blank=True, max_length=20)),\n                ('is_default', models.BooleanField(default=False)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payment_methods', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Purchase',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),\n                ('status', models.CharField(choices=[('pending', 'Pending'), ('completed', 'Completed'), ('failed', 'Failed'), ('refunded', 'Refunded')], default='pending', max_length=20)),\n                ('stripe_payment_intent_id', models.CharField(blank=True, max_length=255, null=True)),\n                ('transaction_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('completed_at', models.DateTimeField(blank=True, null=True)),\n                ('course', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='purchases', to='courses.course')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='purchases', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Transaction',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('transaction_type', models.CharField(choices=[('purchase', 'Course Purchase'), ('refund', 'Refund')], default='purchase', max_length=20)),\n                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),\n                ('stripe_charge_id', models.CharField(blank=True, max_length=255, null=True)),\n                ('payment_method', models.CharField(blank=True, max_length=50, null=True)),\n                ('description', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('purchase', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='payments.purchase')),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n    ]\n","size_bytes":3538},"elearning/payments/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass PaymentsConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'elearning.payments'\n","size_bytes":158},"elearning/payments/migrations/__init__.py":{"content":"","size_bytes":0},"elearning/payments/models.py":{"content":"from django.db import models\nfrom django.conf import settings\nfrom elearning.courses.models import Course\nimport uuid\n\nclass Purchase(models.Model):\n    STATUS_CHOICES = [\n        ('pending', 'Pending'),\n        ('completed', 'Completed'),\n        ('failed', 'Failed'),\n        ('refunded', 'Refunded'),\n    ]\n    \n    student = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='purchases')\n    course = models.ForeignKey(Course, on_delete=models.CASCADE, related_name='purchases')\n    amount = models.DecimalField(max_digits=10, decimal_places=2)\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')\n    stripe_payment_intent_id = models.CharField(max_length=255, blank=True, null=True)\n    transaction_id = models.UUIDField(default=uuid.uuid4, editable=False, unique=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    completed_at = models.DateTimeField(blank=True, null=True)\n    \n    def __str__(self):\n        return f\"{self.student.username} - {self.course.title} - {self.status}\"\n    \n    class Meta:\n        ordering = ['-created_at']\n\n\nclass Transaction(models.Model):\n    TRANSACTION_TYPES = [\n        ('purchase', 'Course Purchase'),\n        ('refund', 'Refund'),\n    ]\n    \n    purchase = models.ForeignKey(Purchase, on_delete=models.CASCADE, related_name='transactions')\n    transaction_type = models.CharField(max_length=20, choices=TRANSACTION_TYPES, default='purchase')\n    amount = models.DecimalField(max_digits=10, decimal_places=2)\n    stripe_charge_id = models.CharField(max_length=255, blank=True, null=True)\n    payment_method = models.CharField(max_length=50, blank=True, null=True)\n    description = models.TextField(blank=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    def __str__(self):\n        return f\"{self.transaction_type} - {self.amount} - {self.created_at}\"\n    \n    class Meta:\n        ordering = ['-created_at']\n\n\nclass PaymentMethod(models.Model):\n    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='payment_methods')\n    stripe_payment_method_id = models.CharField(max_length=255)\n    card_last4 = models.CharField(max_length=4, blank=True)\n    card_brand = models.CharField(max_length=20, blank=True)\n    is_default = models.BooleanField(default=False)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    def __str__(self):\n        return f\"{self.user.username} - {self.card_brand} **** {self.card_last4}\"\n    \n    class Meta:\n        ordering = ['-created_at']\n","size_bytes":2621},"elearning/accounts/middleware.py":{"content":"from django.utils.deprecation import MiddlewareMixin\nfrom django.contrib.sessions.models import Session\nfrom .models import UserSession\n\nclass SingleDeviceLoginMiddleware(MiddlewareMixin):\n    def process_request(self, request):\n        if request.user.is_authenticated:\n            session_key = request.session.session_key\n            \n            if session_key:\n                user_agent = request.META.get('HTTP_USER_AGENT', '')[:255]\n                ip_address = self.get_client_ip(request)\n                \n                active_sessions = UserSession.objects.filter(\n                    user=request.user,\n                    is_active=True\n                ).exclude(session_key=session_key)\n                \n                for old_session in active_sessions:\n                    try:\n                        Session.objects.filter(session_key=old_session.session_key).delete()\n                    except:\n                        pass\n                    old_session.is_active = False\n                    old_session.save()\n                \n                user_session, created = UserSession.objects.get_or_create(\n                    user=request.user,\n                    session_key=session_key,\n                    defaults={\n                        'device_info': user_agent,\n                        'ip_address': ip_address,\n                        'is_active': True\n                    }\n                )\n                \n                if not created:\n                    user_session.device_info = user_agent\n                    user_session.ip_address = ip_address\n                    user_session.is_active = True\n                    user_session.save()\n    \n    def get_client_ip(self, request):\n        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')\n        if x_forwarded_for:\n            ip = x_forwarded_for.split(',')[0]\n        else:\n            ip = request.META.get('REMOTE_ADDR')\n        return ip\n","size_bytes":1945},"manage.py":{"content":"#!/usr/bin/env python\n\"\"\"Django's command-line utility for administrative tasks.\"\"\"\nimport os\nimport sys\n\n\ndef main():\n    \"\"\"Run administrative tasks.\"\"\"\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'elearning.settings')\n    try:\n        from django.core.management import execute_from_command_line\n    except ImportError as exc:\n        raise ImportError(\n            \"Couldn't import Django. Are you sure it's installed and \"\n            \"available on your PYTHONPATH environment variable? Did you \"\n            \"forget to activate a virtual environment?\"\n        ) from exc\n    execute_from_command_line(sys.argv)\n\n\nif __name__ == '__main__':\n    main()\n","size_bytes":665},"elearning/courses/tests.py":{"content":"from django.test import TestCase\n\n# Create your tests here.\n","size_bytes":60},"elearning/quizzes/views.py":{"content":"from django.shortcuts import render\n\n# Create your views here.\n","size_bytes":63},"elearning/asgi.py":{"content":"\"\"\"\nASGI config for elearning project.\n\nIt exposes the ASGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.2/howto/deployment/asgi/\n\"\"\"\n\nimport os\n\nfrom django.core.asgi import get_asgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'elearning.settings')\n\napplication = get_asgi_application()\n","size_bytes":395},"elearning/courses/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass CoursesConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'elearning.courses'\n","size_bytes":156},"elearning/courses/models.py":{"content":"from django.db import models\nfrom django.conf import settings\nfrom django.utils.text import slugify\n\nclass Category(models.Model):\n    name = models.CharField(max_length=100, unique=True)\n    description = models.TextField(blank=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    def __str__(self):\n        return self.name\n    \n    class Meta:\n        verbose_name_plural = 'Categories'\n        ordering = ['name']\n\n\nclass Course(models.Model):\n    title = models.CharField(max_length=200)\n    slug = models.SlugField(max_length=200, unique=True, blank=True)\n    description = models.TextField()\n    tutor = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='courses')\n    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True, related_name='courses')\n    thumbnail = models.ImageField(upload_to='course_thumbnails/', blank=True, null=True)\n    price = models.DecimalField(max_digits=10, decimal_places=2, default=0.00)\n    is_free = models.BooleanField(default=False)\n    is_approved = models.BooleanField(default=False)\n    is_published = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def save(self, *args, **kwargs):\n        if not self.slug:\n            self.slug = slugify(self.title)\n        super().save(*args, **kwargs)\n    \n    def __str__(self):\n        return self.title\n    \n    def get_total_units(self):\n        return self.units.count()\n    \n    def get_enrolled_students(self):\n        from elearning.payments.models import Purchase\n        return Purchase.objects.filter(course=self, status='completed').count()\n    \n    class Meta:\n        ordering = ['-created_at']\n\n\nclass Unit(models.Model):\n    course = models.ForeignKey(Course, on_delete=models.CASCADE, related_name='units')\n    title = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    order = models.PositiveIntegerField(default=0)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def __str__(self):\n        return f\"{self.course.title} - {self.title}\"\n    \n    class Meta:\n        ordering = ['order']\n        unique_together = ['course', 'order']\n\n\nclass Video(models.Model):\n    unit = models.ForeignKey(Unit, on_delete=models.CASCADE, related_name='videos')\n    title = models.CharField(max_length=200)\n    video_url = models.URLField(help_text=\"Video URL (YouTube, Vimeo, or direct link)\")\n    video_file = models.FileField(upload_to='videos/', blank=True, null=True)\n    thumbnail = models.ImageField(upload_to='video_thumbnails/', blank=True, null=True)\n    duration = models.PositiveIntegerField(help_text=\"Duration in seconds\", default=0)\n    order = models.PositiveIntegerField(default=0)\n    is_free = models.BooleanField(default=False)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def __str__(self):\n        return f\"{self.unit.title} - {self.title}\"\n    \n    class Meta:\n        ordering = ['order']\n        unique_together = ['unit', 'order']\n\n\nclass Material(models.Model):\n    MATERIAL_TYPES = [\n        ('pdf', 'PDF'),\n        ('doc', 'Document'),\n        ('slide', 'Slides'),\n        ('other', 'Other'),\n    ]\n    \n    unit = models.ForeignKey(Unit, on_delete=models.CASCADE, related_name='materials')\n    title = models.CharField(max_length=200)\n    file = models.FileField(upload_to='materials/')\n    material_type = models.CharField(max_length=10, choices=MATERIAL_TYPES, default='pdf')\n    is_free = models.BooleanField(default=False)\n    is_downloadable = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    def __str__(self):\n        return self.title\n    \n    class Meta:\n        ordering = ['title']\n\n\nclass VideoWatch(models.Model):\n    student = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='video_watches')\n    video = models.ForeignKey(Video, on_delete=models.CASCADE, related_name='watches')\n    watch_time = models.PositiveIntegerField(default=0, help_text=\"Total watch time in seconds\")\n    progress = models.FloatField(default=0.0, help_text=\"Percentage watched (0-100)\")\n    is_completed = models.BooleanField(default=False)\n    last_position = models.PositiveIntegerField(default=0, help_text=\"Last watched position in seconds\")\n    is_active = models.BooleanField(default=False, help_text=\"Is currently watching\")\n    started_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    completed_at = models.DateTimeField(blank=True, null=True)\n    \n    def __str__(self):\n        return f\"{self.student.username} - {self.video.title}\"\n    \n    class Meta:\n        unique_together = ['student', 'video']\n        ordering = ['-updated_at']\n\n\nclass Attendance(models.Model):\n    student = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='attendances')\n    video = models.ForeignKey(Video, on_delete=models.CASCADE, related_name='attendances')\n    unit = models.ForeignKey(Unit, on_delete=models.CASCADE, related_name='attendances')\n    date = models.DateField(auto_now_add=True)\n    active_watch_time = models.PositiveIntegerField(default=0, help_text=\"Active watch time in seconds\")\n    is_present = models.BooleanField(default=False)\n    \n    def __str__(self):\n        return f\"{self.student.username} - {self.video.title} - {self.date}\"\n    \n    class Meta:\n        unique_together = ['student', 'video', 'date']\n        ordering = ['-date']\n\n\nclass CourseEnrollment(models.Model):\n    student = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='enrollments')\n    course = models.ForeignKey(Course, on_delete=models.CASCADE, related_name='enrollments')\n    enrolled_at = models.DateTimeField(auto_now_add=True)\n    is_active = models.BooleanField(default=True)\n    progress = models.FloatField(default=0.0, help_text=\"Course completion percentage\")\n    \n    def __str__(self):\n        return f\"{self.student.username} - {self.course.title}\"\n    \n    class Meta:\n        unique_together = ['student', 'course']\n        ordering = ['-enrolled_at']\n","size_bytes":6321},"elearning/accounts/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.7 on 2025-10-14 08:37\n\nimport django.contrib.auth.models\nimport django.contrib.auth.validators\nimport django.db.models.deletion\nimport django.utils.timezone\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        ('auth', '0012_alter_user_first_name_max_length'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='User',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('password', models.CharField(max_length=128, verbose_name='password')),\n                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),\n                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),\n                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),\n                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),\n                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),\n                ('email', models.EmailField(blank=True, max_length=254, verbose_name='email address')),\n                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),\n                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),\n                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),\n                ('role', models.CharField(choices=[('admin', 'Admin'), ('tutor', 'Tutor'), ('student', 'Student')], default='student', max_length=10)),\n                ('phone', models.CharField(blank=True, max_length=20, null=True)),\n                ('email_verified', models.BooleanField(default=False)),\n                ('phone_verified', models.BooleanField(default=False)),\n                ('is_suspended', models.BooleanField(default=False)),\n                ('profile_picture', models.ImageField(blank=True, null=True, upload_to='profiles/')),\n                ('bio', models.TextField(blank=True, null=True)),\n                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),\n                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),\n            ],\n            options={\n                'verbose_name': 'user',\n                'verbose_name_plural': 'users',\n                'abstract': False,\n            },\n            managers=[\n                ('objects', django.contrib.auth.models.UserManager()),\n            ],\n        ),\n        migrations.CreateModel(\n            name='ActivityLog',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('action', models.CharField(max_length=255)),\n                ('description', models.TextField(blank=True)),\n                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),\n                ('timestamp', models.DateTimeField(auto_now_add=True)),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activity_logs', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-timestamp'],\n            },\n        ),\n        migrations.CreateModel(\n            name='UserSession',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('session_key', models.CharField(max_length=40, unique=True)),\n                ('device_info', models.CharField(blank=True, max_length=255)),\n                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('last_activity', models.DateTimeField(auto_now=True)),\n                ('is_active', models.BooleanField(default=True)),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_sessions', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-last_activity'],\n            },\n        ),\n    ]\n","size_bytes":5214},"elearning/settings.py":{"content":"\"\"\"\nDjango settings for elearning project.\n\nGenerated by 'django-admin startproject' using Django 5.2.7.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.2/topics/settings/\n\nFor the full list of settings and their values, see\nhttps://docs.djangoproject.com/en/5.2/ref/settings/\n\"\"\"\n\nfrom pathlib import Path\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# Build paths inside the project like this: BASE_DIR / 'subdir'.\nBASE_DIR = Path(__file__).resolve().parent.parent\n\n\n# Quick-start development settings - unsuitable for production\n# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/\n\n# SECURITY WARNING: keep the secret key used in production secret!\nSECRET_KEY = 'django-insecure-s6fh8mk&qaopm4l*mpjsm$3ws=9vhm*pn&=(c*5$4*%n=449)o'\n\n# SECURITY WARNING: don't run with debug turned on in production!\nDEBUG = True\n\nALLOWED_HOSTS = ['*']\n\n# CSRF and HTTPS Configuration for Replit\nCSRF_TRUSTED_ORIGINS = [\n    'https://*.repl.co',\n    'https://*.id.repl.co',\n    'https://*.replit.app',\n    'https://*.replit.dev',\n]\n\n# Tell Django to trust Replit's proxy headers for HTTPS\nSECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')\n\n# Application definition\n\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'crispy_forms',\n    'crispy_tailwind',\n    'elearning.accounts',\n    'elearning.courses',\n    'elearning.quizzes',\n    'elearning.payments',\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\n    'elearning.accounts.middleware.SingleDeviceLoginMiddleware',\n]\n\nROOT_URLCONF = 'elearning.urls'\n\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [BASE_DIR / 'templates'],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n                'django.template.context_processors.media',\n            ],\n        },\n    },\n]\n\nWSGI_APPLICATION = 'elearning.wsgi.application'\n\n\n# Database\n# https://docs.djangoproject.com/en/5.2/ref/settings/#databases\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql',\n        'NAME': os.getenv('PGDATABASE'),\n        'USER': os.getenv('PGUSER'),\n        'PASSWORD': os.getenv('PGPASSWORD'),\n        'HOST': os.getenv('PGHOST'),\n        'PORT': os.getenv('PGPORT'),\n    }\n}\n\n\n# Password validation\n# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators\n\nAUTH_PASSWORD_VALIDATORS = [\n    {\n        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',\n    },\n]\n\n\n# Internationalization\n# https://docs.djangoproject.com/en/5.2/topics/i18n/\n\nLANGUAGE_CODE = 'en-us'\n\nTIME_ZONE = 'UTC'\n\nUSE_I18N = True\n\nUSE_TZ = True\n\n\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/5.2/howto/static-files/\n\nSTATIC_URL = '/static/'\nSTATICFILES_DIRS = [BASE_DIR / 'static']\nSTATIC_ROOT = BASE_DIR / 'staticfiles'\n\nMEDIA_URL = '/media/'\nMEDIA_ROOT = BASE_DIR / 'media'\n\n# Default primary key field type\n# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field\n\nDEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'\n\n# Custom User Model\nAUTH_USER_MODEL = 'accounts.User'\n\n# Crispy Forms Configuration\nCRISPY_ALLOWED_TEMPLATE_PACKS = \"tailwind\"\nCRISPY_TEMPLATE_PACK = \"tailwind\"\n\n# Session Configuration - 3 months expiry\nSESSION_COOKIE_AGE = 60 * 60 * 24 * 90  # 90 days in seconds\nSESSION_SAVE_EVERY_REQUEST = True\n\n# Login URLs\nLOGIN_URL = '/accounts/login/'\nLOGIN_REDIRECT_URL = '/'\nLOGOUT_REDIRECT_URL = '/accounts/login/'\n\n# Stripe Configuration\nSTRIPE_PUBLIC_KEY = os.getenv('STRIPE_PUBLIC_KEY', '')\nSTRIPE_SECRET_KEY = os.getenv('STRIPE_SECRET_KEY', '')\nSTRIPE_WEBHOOK_SECRET = os.getenv('STRIPE_WEBHOOK_SECRET', '')\n","size_bytes":4721},"elearning/courses/__init__.py":{"content":"","size_bytes":0},"elearning/accounts/migrations/__init__.py":{"content":"","size_bytes":0},"elearning/__init__.py":{"content":"","size_bytes":0},"elearning/payments/tests.py":{"content":"from django.test import TestCase\n\n# Create your tests here.\n","size_bytes":60},"elearning/quizzes/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass QuizzesConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'elearning.quizzes'\n","size_bytes":156},"elearning/quizzes/models.py":{"content":"from django.db import models\nfrom django.conf import settings\nfrom elearning.courses.models import Video, Unit\n\nclass Question(models.Model):\n    QUESTION_TYPES = [\n        ('mcq', 'Multiple Choice'),\n        ('true_false', 'True/False'),\n    ]\n    \n    video = models.ForeignKey(Video, on_delete=models.CASCADE, related_name='questions')\n    question_text = models.TextField()\n    question_type = models.CharField(max_length=20, choices=QUESTION_TYPES, default='mcq')\n    points = models.PositiveIntegerField(default=1)\n    order = models.PositiveIntegerField(default=0)\n    created_at = models.DateTimeField(auto_now_add=True)\n    \n    def __str__(self):\n        return f\"{self.video.title} - {self.question_text[:50]}\"\n    \n    class Meta:\n        ordering = ['order']\n\n\nclass Answer(models.Model):\n    question = models.ForeignKey(Question, on_delete=models.CASCADE, related_name='answers')\n    answer_text = models.CharField(max_length=500)\n    is_correct = models.BooleanField(default=False)\n    order = models.PositiveIntegerField(default=0)\n    \n    def __str__(self):\n        return f\"{self.question.question_text[:30]} - {self.answer_text[:30]}\"\n    \n    class Meta:\n        ordering = ['order']\n\n\nclass Quiz(models.Model):\n    video = models.OneToOneField(Video, on_delete=models.CASCADE, related_name='quiz')\n    title = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    pass_percentage = models.PositiveIntegerField(default=70)\n    time_limit = models.PositiveIntegerField(default=30, help_text=\"Time limit in minutes\")\n    is_active = models.BooleanField(default=True)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def __str__(self):\n        return self.title\n    \n    def get_total_questions(self):\n        return self.video.questions.count()\n    \n    def get_total_points(self):\n        return sum(q.points for q in self.video.questions.all())\n    \n    class Meta:\n        verbose_name_plural = 'Quizzes'\n\n\nclass QuizAttempt(models.Model):\n    student = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='quiz_attempts')\n    quiz = models.ForeignKey(Quiz, on_delete=models.CASCADE, related_name='attempts')\n    video = models.ForeignKey(Video, on_delete=models.CASCADE, related_name='quiz_attempts')\n    score = models.FloatField(default=0.0)\n    total_points = models.PositiveIntegerField(default=0)\n    percentage = models.FloatField(default=0.0)\n    is_passed = models.BooleanField(default=False)\n    time_taken = models.PositiveIntegerField(default=0, help_text=\"Time taken in seconds\")\n    started_at = models.DateTimeField(auto_now_add=True)\n    completed_at = models.DateTimeField(blank=True, null=True)\n    \n    def __str__(self):\n        return f\"{self.student.username} - {self.quiz.title} - {self.percentage}%\"\n    \n    class Meta:\n        ordering = ['-started_at']\n\n\nclass StudentAnswer(models.Model):\n    attempt = models.ForeignKey(QuizAttempt, on_delete=models.CASCADE, related_name='student_answers')\n    question = models.ForeignKey(Question, on_delete=models.CASCADE)\n    selected_answer = models.ForeignKey(Answer, on_delete=models.CASCADE, blank=True, null=True)\n    is_correct = models.BooleanField(default=False)\n    points_earned = models.FloatField(default=0.0)\n    \n    def __str__(self):\n        return f\"{self.attempt.student.username} - Q: {self.question.question_text[:30]}\"\n    \n    class Meta:\n        unique_together = ['attempt', 'question']\n\n\nclass Leaderboard(models.Model):\n    unit = models.ForeignKey(Unit, on_delete=models.CASCADE, related_name='leaderboards')\n    student = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='leaderboard_entries')\n    total_score = models.FloatField(default=0.0)\n    total_quizzes = models.PositiveIntegerField(default=0)\n    average_score = models.FloatField(default=0.0)\n    rank = models.PositiveIntegerField(default=0)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    def __str__(self):\n        return f\"{self.unit.title} - {self.student.username} - Rank {self.rank}\"\n    \n    class Meta:\n        unique_together = ['unit', 'student']\n        ordering = ['rank']\n","size_bytes":4243},"elearning/courses/views.py":{"content":"from django.shortcuts import render\n\n# Create your views here.\n","size_bytes":63},"elearning/quizzes/__init__.py":{"content":"","size_bytes":0},"elearning/wsgi.py":{"content":"\"\"\"\nWSGI config for elearning project.\n\nIt exposes the WSGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/\n\"\"\"\n\nimport os\n\nfrom django.core.wsgi import get_wsgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'elearning.settings')\n\napplication = get_wsgi_application()\n","size_bytes":395},"elearning/accounts/decorators.py":{"content":"from django.contrib.auth.decorators import login_required\nfrom django.shortcuts import redirect\nfrom django.contrib import messages\nfrom functools import wraps\n\ndef role_required(allowed_roles):\n    def decorator(view_func):\n        @wraps(view_func)\n        @login_required\n        def wrapper(request, *args, **kwargs):\n            if request.user.role not in allowed_roles:\n                messages.error(request, 'You do not have permission to access this page.')\n                return redirect('home')\n            return view_func(request, *args, **kwargs)\n        return wrapper\n    return decorator\n\ndef admin_required(view_func):\n    return role_required(['admin'])(view_func)\n\ndef tutor_required(view_func):\n    return role_required(['tutor', 'admin'])(view_func)\n\ndef student_required(view_func):\n    return role_required(['student'])(view_func)\n","size_bytes":857},"elearning/accounts/views.py":{"content":"from django.shortcuts import render, redirect\nfrom django.contrib.auth import login, logout, authenticate\nfrom django.contrib.auth.decorators import login_required\nfrom django.contrib import messages\nfrom django.views.decorators.http import require_http_methods\nfrom .models import User\n\n@require_http_methods([\"GET\", \"POST\"])\ndef login_view(request):\n    if request.user.is_authenticated:\n        return redirect('home')\n    \n    if request.method == 'POST':\n        username = request.POST.get('username')\n        password = request.POST.get('password')\n        user = authenticate(request, username=username, password=password)\n        \n        if user is not None:\n            if user.is_suspended:\n                messages.error(request, 'Your account has been suspended.')\n                return render(request, 'accounts/login.html')\n            \n            login(request, user)\n            \n            if user.is_admin():\n                return redirect('admin_dashboard')\n            elif user.is_tutor():\n                return redirect('tutor_dashboard')\n            else:\n                return redirect('student_dashboard')\n        else:\n            messages.error(request, 'Invalid username or password.')\n    \n    return render(request, 'accounts/login.html')\n\n@require_http_methods([\"GET\", \"POST\"])\ndef register_view(request):\n    if request.user.is_authenticated:\n        return redirect('home')\n    \n    if request.method == 'POST':\n        username = request.POST.get('username')\n        email = request.POST.get('email')\n        password = request.POST.get('password')\n        password_confirm = request.POST.get('password_confirm')\n        role = request.POST.get('role', 'student')\n        \n        if role not in ['student', 'tutor']:\n            messages.error(request, 'Invalid role selected.')\n            return render(request, 'accounts/register.html')\n        \n        if password != password_confirm:\n            messages.error(request, 'Passwords do not match.')\n            return render(request, 'accounts/register.html')\n        \n        if User.objects.filter(username=username).exists():\n            messages.error(request, 'Username already exists.')\n            return render(request, 'accounts/register.html')\n        \n        if User.objects.filter(email=email).exists():\n            messages.error(request, 'Email already exists.')\n            return render(request, 'accounts/register.html')\n        \n        user = User.objects.create_user(\n            username=username,\n            email=email,\n            password=password,\n            role=role\n        )\n        \n        messages.success(request, 'Account created successfully! Please login.')\n        return redirect('login')\n    \n    return render(request, 'accounts/register.html')\n\n@login_required\ndef logout_view(request):\n    logout(request)\n    messages.success(request, 'You have been logged out successfully.')\n    return redirect('login')\n\ndef home_view(request):\n    return render(request, 'home.html')\n\nfrom .decorators import admin_required, tutor_required, student_required\n\n@admin_required\ndef admin_dashboard(request):\n    return render(request, 'dashboards/admin.html')\n\n@tutor_required\ndef tutor_dashboard(request):\n    return render(request, 'dashboards/tutor.html')\n\n@student_required\ndef student_dashboard(request):\n    return render(request, 'dashboards/student.html')\n","size_bytes":3392},"elearning/courses/migrations/__init__.py":{"content":"","size_bytes":0},"elearning/urls.py":{"content":"\"\"\"\nURL configuration for elearning project.\n\nThe `urlpatterns` list routes URLs to views. For more information please see:\n    https://docs.djangoproject.com/en/5.2/topics/http/urls/\nExamples:\nFunction views\n    1. Add an import:  from my_app import views\n    2. Add a URL to urlpatterns:  path('', views.home, name='home')\nClass-based views\n    1. Add an import:  from other_app.views import Home\n    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')\nIncluding another URLconf\n    1. Import the include() function: from django.urls import include, path\n    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))\n\"\"\"\nfrom django.contrib import admin\nfrom django.urls import path\nfrom django.conf import settings\nfrom django.conf.urls.static import static\nfrom elearning.accounts.views import (\n    home_view, login_view, register_view, logout_view,\n    admin_dashboard, tutor_dashboard, student_dashboard\n)\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n    path('', home_view, name='home'),\n    path('accounts/login/', login_view, name='login'),\n    path('accounts/register/', register_view, name='register'),\n    path('accounts/logout/', logout_view, name='logout'),\n    path('admin-dashboard/', admin_dashboard, name='admin_dashboard'),\n    path('tutor-dashboard/', tutor_dashboard, name='tutor_dashboard'),\n    path('student-dashboard/', student_dashboard, name='student_dashboard'),\n]\n\nif settings.DEBUG:\n    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)\n    urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)\n","size_bytes":1611},"elearning/quizzes/admin.py":{"content":"from django.contrib import admin\nfrom .models import Question, Answer, Quiz, QuizAttempt, StudentAnswer, Leaderboard\n\nclass AnswerInline(admin.TabularInline):\n    model = Answer\n    extra = 4\n\n@admin.register(Question)\nclass QuestionAdmin(admin.ModelAdmin):\n    list_display = ['question_text', 'video', 'question_type', 'points', 'order']\n    list_filter = ['question_type', 'video__unit__course']\n    search_fields = ['question_text', 'video__title']\n    inlines = [AnswerInline]\n\n@admin.register(Quiz)\nclass QuizAdmin(admin.ModelAdmin):\n    list_display = ['title', 'video', 'pass_percentage', 'time_limit', 'is_active']\n    list_filter = ['is_active', 'created_at']\n    search_fields = ['title', 'video__title']\n\n@admin.register(QuizAttempt)\nclass QuizAttemptAdmin(admin.ModelAdmin):\n    list_display = ['student', 'quiz', 'percentage', 'is_passed', 'completed_at']\n    list_filter = ['is_passed', 'started_at']\n    search_fields = ['student__username', 'quiz__title']\n\n@admin.register(StudentAnswer)\nclass StudentAnswerAdmin(admin.ModelAdmin):\n    list_display = ['attempt', 'question', 'selected_answer', 'is_correct', 'points_earned']\n    list_filter = ['is_correct']\n    search_fields = ['attempt__student__username', 'question__question_text']\n\n@admin.register(Leaderboard)\nclass LeaderboardAdmin(admin.ModelAdmin):\n    list_display = ['unit', 'student', 'rank', 'total_score', 'average_score', 'updated_at']\n    list_filter = ['unit', 'updated_at']\n    search_fields = ['student__username', 'unit__title']\n","size_bytes":1516},"elearning/payments/admin.py":{"content":"from django.contrib import admin\nfrom .models import Purchase, Transaction, PaymentMethod\n\n@admin.register(Purchase)\nclass PurchaseAdmin(admin.ModelAdmin):\n    list_display = ['student', 'course', 'amount', 'status', 'created_at', 'completed_at']\n    list_filter = ['status', 'created_at']\n    search_fields = ['student__username', 'course__title', 'transaction_id']\n    readonly_fields = ['transaction_id']\n\n@admin.register(Transaction)\nclass TransactionAdmin(admin.ModelAdmin):\n    list_display = ['purchase', 'transaction_type', 'amount', 'payment_method', 'created_at']\n    list_filter = ['transaction_type', 'created_at']\n    search_fields = ['purchase__student__username', 'stripe_charge_id']\n\n@admin.register(PaymentMethod)\nclass PaymentMethodAdmin(admin.ModelAdmin):\n    list_display = ['user', 'card_brand', 'card_last4', 'is_default', 'created_at']\n    list_filter = ['card_brand', 'is_default']\n    search_fields = ['user__username', 'card_last4']\n","size_bytes":959},"elearning/accounts/tests.py":{"content":"from django.test import TestCase\n\n# Create your tests here.\n","size_bytes":60},"elearning/courses/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.7 on 2025-10-14 08:37\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Category',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=100, unique=True)),\n                ('description', models.TextField(blank=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'verbose_name_plural': 'Categories',\n                'ordering': ['name'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Course',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('slug', models.SlugField(blank=True, max_length=200, unique=True)),\n                ('description', models.TextField()),\n                ('thumbnail', models.ImageField(blank=True, null=True, upload_to='course_thumbnails/')),\n                ('price', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),\n                ('is_free', models.BooleanField(default=False)),\n                ('is_approved', models.BooleanField(default=False)),\n                ('is_published', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('category', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='courses', to='courses.category')),\n                ('tutor', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='courses', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-created_at'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Unit',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('description', models.TextField(blank=True)),\n                ('order', models.PositiveIntegerField(default=0)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('course', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='units', to='courses.course')),\n            ],\n            options={\n                'ordering': ['order'],\n                'unique_together': {('course', 'order')},\n            },\n        ),\n        migrations.CreateModel(\n            name='Material',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('file', models.FileField(upload_to='materials/')),\n                ('material_type', models.CharField(choices=[('pdf', 'PDF'), ('doc', 'Document'), ('slide', 'Slides'), ('other', 'Other')], default='pdf', max_length=10)),\n                ('is_free', models.BooleanField(default=False)),\n                ('is_downloadable', models.BooleanField(default=True)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('unit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='materials', to='courses.unit')),\n            ],\n            options={\n                'ordering': ['title'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Video',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('title', models.CharField(max_length=200)),\n                ('video_url', models.URLField(help_text='Video URL (YouTube, Vimeo, or direct link)')),\n                ('video_file', models.FileField(blank=True, null=True, upload_to='videos/')),\n                ('thumbnail', models.ImageField(blank=True, null=True, upload_to='video_thumbnails/')),\n                ('duration', models.PositiveIntegerField(default=0, help_text='Duration in seconds')),\n                ('order', models.PositiveIntegerField(default=0)),\n                ('is_free', models.BooleanField(default=False)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('unit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='videos', to='courses.unit')),\n            ],\n            options={\n                'ordering': ['order'],\n                'unique_together': {('unit', 'order')},\n            },\n        ),\n        migrations.CreateModel(\n            name='CourseEnrollment',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('enrolled_at', models.DateTimeField(auto_now_add=True)),\n                ('is_active', models.BooleanField(default=True)),\n                ('progress', models.FloatField(default=0.0, help_text='Course completion percentage')),\n                ('course', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enrollments', to='courses.course')),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enrollments', to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'ordering': ['-enrolled_at'],\n                'unique_together': {('student', 'course')},\n            },\n        ),\n        migrations.CreateModel(\n            name='Attendance',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('date', models.DateField(auto_now_add=True)),\n                ('active_watch_time', models.PositiveIntegerField(default=0, help_text='Active watch time in seconds')),\n                ('is_present', models.BooleanField(default=False)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attendances', to=settings.AUTH_USER_MODEL)),\n                ('unit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attendances', to='courses.unit')),\n                ('video', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attendances', to='courses.video')),\n            ],\n            options={\n                'ordering': ['-date'],\n                'unique_together': {('student', 'video', 'date')},\n            },\n        ),\n        migrations.CreateModel(\n            name='VideoWatch',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('watch_time', models.PositiveIntegerField(default=0, help_text='Total watch time in seconds')),\n                ('progress', models.FloatField(default=0.0, help_text='Percentage watched (0-100)')),\n                ('is_completed', models.BooleanField(default=False)),\n                ('last_position', models.PositiveIntegerField(default=0, help_text='Last watched position in seconds')),\n                ('is_active', models.BooleanField(default=False, help_text='Is currently watching')),\n                ('started_at', models.DateTimeField(auto_now_add=True)),\n                ('updated_at', models.DateTimeField(auto_now=True)),\n                ('completed_at', models.DateTimeField(blank=True, null=True)),\n                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='video_watches', to=settings.AUTH_USER_MODEL)),\n                ('video', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='watches', to='courses.video')),\n            ],\n            options={\n                'ordering': ['-updated_at'],\n                'unique_together': {('student', 'video')},\n            },\n        ),\n    ]\n","size_bytes":8591},"elearning/quizzes/tests.py":{"content":"from django.test import TestCase\n\n# Create your tests here.\n","size_bytes":60},"elearning/accounts/__init__.py":{"content":"","size_bytes":0}},"version":2}